
CREATE TABLE #TEMP1(ID INT,Record_type VARCHAR(20),IND CHAR)
CREATE TABLE #TEMP2(ID INT,Record_type VARCHAR(20),IND CHAR)

INSERT INTO #TEMP1 VALUES
(1,'ADD','P'),
(2,'ADD','P'),
(3,'ADD','P'),
(4,'ADD','P'),
(5,'ADD','P'),
(6,'ADD','P'),
(7,'ADD','P'),
(8,'ADD','P'),
(9,'UPDATE','P'),
(10,'DELETE','P')


MERGE #TEMP2 AS TARGET
USING #TEMP1 AS SOURCE 
ON (
 TARGET.ID=SOURCE.ID 
) 
WHEN NOT MATCHED BY TARGET AND SOURCE.Record_type='ADD'  THEN  
INSERT (ID,Record_type,IND)VALUES(SOURCE.ID,SOURCE.Record_type,SOURCE.IND)
--WHEN MATCHED AND SOURCE.Record_type='ADD' AND TARGET.IND NOT IN('P','R','B')  THEN  ADD
WHEN MATCHED AND SOURCE.Record_type='ADD' AND TARGET.IND ='P' AND SOURCE.IND='R' THEN  --UPDATE IND AS B
UPDATE SET  TARGET.IND='B'
WHEN MATCHED AND SOURCE.Record_type='ADD' AND TARGET.IND ='R' AND SOURCE.IND='P' THEN  --UPDATE IND AS B
UPDATE SET  TARGET.IND='B'

WHEN MATCHED AND SOURCE.Record_type='ADD' AND TARGET.IND ='P' AND SOURCE.IND='P' THEN  --UPDATE  NO UPDATE ON IND 
UPDATE SET  TARGET.IND='Q'
WHEN MATCHED AND SOURCE.Record_type='ADD' AND TARGET.IND ='R' AND SOURCE.IND='R' THEN  --UPDATE   NO UPDATE ON IND 
UPDATE SET  TARGET.IND='S'

WHEN MATCHED AND SOURCE.Record_type='ADD' AND TARGET.IND ='B' AND SOURCE.IND='P' THEN  --UPDATE IND AS P
UPDATE SET  TARGET.IND='P'
WHEN MATCHED AND SOURCE.Record_type='ADD' AND TARGET.IND ='B' AND SOURCE.IND='R' THEN  --UPDATE IND AS R
UPDATE SET  TARGET.IND='R'

WHEN MATCHED AND SOURCE.Record_type='UPDATE' AND TARGET.IND ='P' AND SOURCE.IND='R' THEN  --UPDATE IND AS B
UPDATE SET  TARGET.IND='B'
WHEN MATCHED AND SOURCE.Record_type='UPDATE' AND TARGET.IND ='R' AND SOURCE.IND='P' THEN  --UPDATE IND AS B
UPDATE SET  TARGET.IND='B'

WHEN MATCHED AND SOURCE.Record_type='UPDATE' AND TARGET.IND ='P' AND SOURCE.IND='P' THEN  --UPDATE  NO UPDATE ON IND 
UPDATE SET  TARGET.IND='X'
WHEN MATCHED AND SOURCE.Record_type='UPDATE' AND TARGET.IND ='R' AND SOURCE.IND='R' THEN  --UPDATE   NO UPDATE ON IND 
UPDATE SET  TARGET.IND='Y'

WHEN MATCHED AND SOURCE.Record_type='UPDATE' AND TARGET.IND ='B' AND SOURCE.IND='P' THEN  --UPDATE IND AS P
UPDATE SET  TARGET.IND='P'
WHEN MATCHED AND SOURCE.Record_type='UPDATE' AND TARGET.IND ='B' AND SOURCE.IND='R' THEN  --UPDATE IND AS R
UPDATE SET  TARGET.IND='R'

WHEN MATCHED AND SOURCE.Record_type='DELETE' AND TARGET.IND ='B' AND SOURCE.IND='P' THEN  --UPDATE IND AS P
UPDATE SET  TARGET.IND='B'
WHEN MATCHED AND SOURCE.Record_type='DELETE' AND TARGET.IND ='B' AND SOURCE.IND='R' THEN  --UPDATE IND AS R
UPDATE SET  TARGET.IND='D'
WHEN MATCHED AND SOURCE.Record_type='DELETE' AND TARGET.IND ='P' AND SOURCE.IND='P' THEN  DELETE
WHEN MATCHED AND SOURCE.Record_type='DELETE' AND TARGET.IND ='R' AND SOURCE.IND='R' THEN  DELETE
WHEN MATCHED AND SOURCE.Record_type='DELETE' AND TARGET.IND ='B' AND SOURCE.IND='B' THEN  DELETE
;




/*
WHEN NOT MATCHED BY TARGET AND SOURCE.Record_type='ADD'  THEN  ADD
--WHEN MATCHED AND SOURCE.Record_type='ADD' AND TARGET.IND NOT IN('P','R','B')  THEN  ADD
WHEN MATCHED AND SOURCE.Record_type='ADD' AND TARGET.IND ='P' AND SOURCE.IND='R' THEN  UPDATE IND AS B
WHEN MATCHED AND SOURCE.Record_type='ADD' AND TARGET.IND ='R' AND SOURCE.IND='P' THEN  UPDATE IND AS B

WHEN MATCHED AND SOURCE.Record_type='ADD' AND TARGET.IND ='P' AND SOURCE.IND='P' THEN  UPDATE  NO UPDATE ON IND 
WHEN MATCHED AND SOURCE.Record_type='ADD' AND TARGET.IND ='R' AND SOURCE.IND='R' THEN  UPDATE   NO UPDATE ON IND 

WHEN MATCHED AND SOURCE.Record_type='ADD' AND TARGET.IND ='B' AND SOURCE.IND='P' THEN  UPDATE IND AS P
WHEN MATCHED AND SOURCE.Record_type='ADD' AND TARGET.IND ='B' AND SOURCE.IND='R' THEN  UPDATE IND AS R

WHEN MATCHED AND SOURCE.Record_type='UPDATE' AND TARGET.IND ='P' AND SOURCE.IND='R' THEN  UPDATE IND AS B
WHEN MATCHED AND SOURCE.Record_type='UPDATE' AND TARGET.IND ='R' AND SOURCE.IND='P' THEN  UPDATE IND AS B

WHEN MATCHED AND SOURCE.Record_type='UPDATE' AND TARGET.IND ='P' AND SOURCE.IND='P' THEN  UPDATE  NO UPDATE ON IND 
WHEN MATCHED AND SOURCE.Record_type='UPDATE' AND TARGET.IND ='R' AND SOURCE.IND='R' THEN  UPDATE   NO UPDATE ON IND 

WHEN MATCHED AND SOURCE.Record_type='UPDATE' AND TARGET.IND ='B' AND SOURCE.IND='P' THEN  UPDATE IND AS P
WHEN MATCHED AND SOURCE.Record_type='UPDATE' AND TARGET.IND ='B' AND SOURCE.IND='R' THEN  UPDATE IND AS R


WHEN MATCHED AND SOURCE.Record_type='DELETE' AND TARGET.IND ='B' AND SOURCE.IND='P' THEN  UPDATE IND AS P
WHEN MATCHED AND SOURCE.Record_type='DELETE' AND TARGET.IND ='B' AND SOURCE.IND='R' THEN  UPDATE IND AS R

WHEN MATCHED AND SOURCE.Record_type='DELETE' AND TARGET.IND ='P' AND SOURCE.IND='P' THEN  DELETE
WHEN MATCHED AND SOURCE.Record_type='DELETE' AND TARGET.IND ='R' AND SOURCE.IND='R' THEN  DELETE
WHEN MATCHED AND SOURCE.Record_type='DELETE' AND TARGET.IND ='B' AND SOURCE.IND='B' THEN  DELETE
*/
